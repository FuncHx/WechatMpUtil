"use strict";(self["webpackChunkwechat_mp_ui"]=self["webpackChunkwechat_mp_ui"]||[]).push([[35],{2035:function(e,t,s){s.r(t),s.d(t,{default:function(){return G}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-info"},[t("el-row",{attrs:{type:"flex"}},[t("el-card",{staticClass:"box-card",attrs:{"body-style":{padding:"20px"}}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{},[e._v("个人信息")])]),t("div",{staticClass:"avatar-wrapper"},[t("img",{staticClass:"user-avatar",attrs:{src:e.avatar},on:{click:function(t){e.opened=!e.opened}}}),t("el-upload",{staticClass:"upload-demo",attrs:{action:e.baseUrl+"user/editAvatar",multiple:"",headers:{Authorization:e.token},limit:1,disabled:e.uploaded,"on-success":e.uplodaSuccess,"show-file-list":!1,"before-upload":e.beforeUpload,"file-list":[]}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),t("el-divider"),t("div",{staticClass:"info-line"},[t("Icon",{attrs:{icon:"wode1",size:"18px"}}),t("span",[e._v("用户名称")]),t("span",{staticStyle:{float:"right"}},[e._v(e._s(e.userInfo.nickName))])],1),t("el-divider"),t("div",{staticClass:"info-line"},[t("Icon",{attrs:{icon:"shouji",size:"18px"}}),t("span",[e._v("手机号码")]),t("span",{staticStyle:{float:"right"}},[e._v(e._s(e.userInfo.phonenumber))])],1),t("el-divider"),t("div",{staticClass:"info-line"},[t("Icon",{attrs:{icon:"xinxi",size:"18px"}}),t("span",[e._v("邮箱地址")]),t("span",{staticStyle:{float:"right"}},[e._v(e._s(e.userInfo.email))])],1),t("el-divider"),t("div",{staticClass:"info-line"},[t("Icon",{attrs:{icon:"haoyourenzheng",size:"18px"}}),t("span",[e._v("所属角色")]),t("span",{staticStyle:{float:"right"}},[e._v(e._s(e.roles.join(" & ")))])],1),t("el-divider"),t("div",{staticClass:"info-line"},[t("Icon",{attrs:{icon:"tianjia1",size:"18px"}}),t("span",[e._v("创建日期")]),t("span",{staticStyle:{float:"right"}},[e._v(e._s(""!==e.userInfo.createTime?e.userInfo.createTime.split("T")[0]:""))])],1),t("el-divider")],1),t("el-card",{staticClass:"info-card",attrs:{"body-style":{padding:"20px"}}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",{},[e._v("基本资料")])]),t("Info")],1)],1),e.opened?t("el-image-viewer",{attrs:{zIndex:Number(99999),"on-close":e.closeImgViewer,"url-list":[e.avatar]}}):e._e()],1)},r=[],a=s(9087),n=s(6012),o=function(){var e=this,t=e._self._c;return t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"info"}},[t("edit-info-vue")],1),t("el-tab-pane",{attrs:{label:"修改密码",name:"editPassword"}},[t("edit-password-vue")],1)],1)},l=[],c=function(){var e=this,t=e._self._c;return t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{required:!0,prop:"nickName",label:"用户名称",rules:{required:!0,message:"名称不能为空",trigger:"blur"}}},[t("el-input",{attrs:{value:e.userInfo.nickName,size:"mini"},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),t("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber",rules:{required:!0,message:"手机号码不能为空",trigger:"blur"}}},[t("el-input",{attrs:{size:"mini"},model:{value:e.form.phonenumber,callback:function(t){e.$set(e.form,"phonenumber",t)},expression:"form.phonenumber"}})],1),t("el-form-item",{attrs:{required:!0,prop:"email",label:"邮箱地址"}},[t("el-input",{attrs:{size:"mini",rules:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{required:!0,prop:"sex",label:"性别",rules:{required:!0,message:"性别不能为空",trigger:"blur"}}},[t("el-radio-group",{model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[t("el-radio",{attrs:{label:"0"}},[e._v("男")]),t("el-radio",{attrs:{label:"1"}},[e._v("女")])],1)],1),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("保存")])],1)},d=[],u=s(2521);function m(e){return(0,u.A)({method:"post",data:e,url:"/user/update"})}function f(e){return(0,u.A)({method:"post",data:e,url:"/user/editPassword"})}var h={data(){return{form:{id:null,nickName:"",phonenumber:"",email:"",sex:""}}},computed:{...(0,a.aH)("user",["userInfo"])},created(){console.log(this.userInfo),this.form=JSON.parse(JSON.stringify(this.userInfo))},methods:{submitForm(){m(this.form).then((e=>{200==e.code?(this.$message({type:"success",message:"修改成功"}),this.$store.dispatch("user/GetUserInfo"),window.location.reload()):this.$message({type:"error",message:e.message})})).catch((e=>{}))}}},p=h,g=s(1656),v=(0,g.A)(p,c,d,!1,null,null,null),w=v.exports,_=function(){var e=this,t=e._self._c;return t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{required:!0,prop:"oldPassword",label:"旧密码",rules:{required:!0,message:"不能为空",trigger:"blur"}}},[t("el-input",{attrs:{type:"password",size:"mini"},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),t("el-form-item",{attrs:{required:!0,prop:"newPasswordOnce",label:"新密码",rules:{required:!0,message:"不能为空",trigger:"blur"}}},[t("el-input",{attrs:{type:"password",size:"mini"},model:{value:e.form.newPasswordOnce,callback:function(t){e.$set(e.form,"newPasswordOnce",t)},expression:"form.newPasswordOnce"}})],1),t("el-form-item",{attrs:{required:!0,prop:"newPassword",label:"确认密码",rules:{required:!0,message:"不能为空",trigger:"blur"}}},[t("el-input",{attrs:{type:"password",size:"mini"},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.resetForm("form")}}},[e._v("重置")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("保存")])],1)},b=[],x={data(){return{form:{oldPassword:"",newPasswordOnce:"",newPassword:""}}},methods:{submitForm(e){this.$refs[e].validate((e=>!!e&&(this.form.newPassword!==this.form.newPasswordOnce?(this.$message({type:"error",message:"两次密码不一致！"}),!1):void f(this.form).then((e=>{200==e.code?(this.$message({type:"success",message:"修改成功！"}),this.$store.dispatch("user/LogOut")):this.$message({type:"error",message:"修改失败！请联系管理员"})})).catch((()=>{})))))},resetForm(e){this.$refs[e].resetFields()}}},k=x,y=(0,g.A)(k,_,b,!1,null,null,null),I=y.exports,C={components:{EditInfoVue:w,EditPasswordVue:I},data(){return{activeName:"info"}},methods:{handleClick(e,t){console.log(e,t)}}},z=C,A=(0,g.A)(z,o,l,!1,null,null,null),$=A.exports,N=function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"viewer-fade"}},[t("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.zIndex},attrs:{tabindex:"-1"}},[t("div",{staticClass:"el-image-viewer__mask"}),t("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[t("i",{staticClass:"el-icon-circle-close"})]),e.isSingle?e._e():[t("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[t("i",{staticClass:"el-icon-arrow-left"})]),t("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[t("i",{staticClass:"el-icon-arrow-right"})])],t("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[t("div",{staticClass:"el-image-viewer__actions__inner"},[t("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.handleActions("zoomOut")}}}),t("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.handleActions("zoomIn")}}}),t("i",{staticClass:"el-image-viewer__actions__divider"}),t("i",{class:e.mode.icon,on:{click:e.toggleMode}}),t("i",{staticClass:"el-image-viewer__actions__divider"}),t("i",{staticClass:"el-icon-refresh-left",on:{click:function(t){return e.handleActions("anticlocelise")}}}),t("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.handleActions("clocelise")}}})])]),t("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,(function(s,i){return i===e.index?t("img",{key:s,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}}):e._e()})),0)],2)])},S=[],O=s(6848);const P=O["default"].prototype.$isServer,L=(P||Number(document.documentMode),function(){return!P&&document.addEventListener?function(e,t,s){e&&t&&s&&e.addEventListener(t,s,!1)}:function(e,t,s){e&&t&&s&&e.attachEvent("on"+t,s)}}()),F=function(){return!P&&document.removeEventListener?function(e,t,s){e&&t&&e.removeEventListener(t,s,!1)}:function(e,t,s){e&&t&&e.detachEvent("on"+t,s)}}();Object.prototype.hasOwnProperty;const T=function(){return!O["default"].prototype.$isServer&&!!window.navigator.userAgent.match(/firefox/i)};function q(e){let t=!1;return function(...s){t||(t=!0,window.requestAnimationFrame((i=>{e.apply(this,s),t=!1})))}}const H={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},D=T()?"DOMMouseScroll":"mousewheel";var E={name:"elImageViewer",props:{urlList:{type:Array,default:()=>[]},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:()=>{}},onClose:{type:Function,default:()=>{}},initialIndex:{type:Number,default:0}},data(){return{index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:H.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle(){return this.urlList.length<=1},isFirst(){return 0===this.index},isLast(){return this.index===this.urlList.length-1},currentImg(){return this.urlList[this.index]},imgStyle(){const{scale:e,deg:t,offsetX:s,offsetY:i,enableTransition:r}=this.transform,a={transform:`scale(${e}) rotate(${t}deg)`,transition:r?"transform .3s":"","margin-left":`${s}px`,"margin-top":`${i}px`};return this.mode===H.CONTAIN&&(a.maxWidth=a.maxHeight="100%"),a}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg(e){this.$nextTick((e=>{const t=this.$refs.img[0];t.complete||(this.loading=!0)}))}},methods:{hide(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall(){this._keyDownHandler=q((e=>{const t=e.keyCode;switch(t){case 27:this.hide();break;case 32:this.toggleMode();break;case 37:this.prev();break;case 38:this.handleActions("zoomIn");break;case 39:this.next();break;case 40:this.handleActions("zoomOut");break}})),this._mouseWheelHandler=q((e=>{const t=e.wheelDelta?e.wheelDelta:-e.detail;t>0?this.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):this.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})})),L(document,"keydown",this._keyDownHandler),L(document,D,this._mouseWheelHandler)},deviceSupportUninstall(){F(document,"keydown",this._keyDownHandler),F(document,D,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(e){this.loading=!1},handleImgError(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown(e){if(this.loading||0!==e.button)return;const{offsetX:t,offsetY:s}=this.transform,i=e.pageX,r=e.pageY;this._dragHandler=q((e=>{this.transform.offsetX=t+e.pageX-i,this.transform.offsetY=s+e.pageY-r})),L(document,"mousemove",this._dragHandler),L(document,"mouseup",(e=>{F(document,"mousemove",this._dragHandler)})),e.preventDefault()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode(){if(this.loading)return;const e=Object.keys(H),t=Object.values(H),s=t.indexOf(this.mode),i=(s+1)%e.length;this.mode=H[e[i]],this.reset()},prev(){if(this.isFirst&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index-1+e)%e},next(){if(this.isLast&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index+1)%e},handleActions(e,t={}){if(this.loading)return;const{zoomRate:s,rotateDeg:i,enableTransition:r}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...t},{transform:a}=this;switch(e){case"zoomOut":a.scale>.2&&(a.scale=parseFloat((a.scale-s).toFixed(3)));break;case"zoomIn":a.scale=parseFloat((a.scale+s).toFixed(3));break;case"clocelise":a.deg+=i;break;case"anticlocelise":a.deg-=i;break}a.enableTransition=r}},mounted(){this.deviceSupportInstall(),this.$refs["el-image-viewer__wrapper"].focus()}},M=E,U=(0,g.A)(M,N,S,!1,null,null,null),j=U.exports,R=s(4130),V=s.n(R),X={components:{elImageViewer:j,Icon:n.A,Info:$},data(){return{opened:!1,uploaded:!1,baseUrl:u.A.defaults.baseURL}},computed:{...(0,a.aH)("user",["userInfo","avatar","token","roles"])},methods:{closeImgViewer(){this.opened=!1},uplodaSuccess(e,t,s){200===e.code?(this.$store.commit("user/SET_AVATAR",e.data),this.$message.success(e.message)):this.$message.error(e.message),V().done()},beforeUpload(e){V().start();const t="image/jpeg"===e.type,s=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&s}}},Y=X,W=(0,g.A)(Y,i,r,!1,null,null,null),G=W.exports}}]);
//# sourceMappingURL=35.dfaf11cb.js.map